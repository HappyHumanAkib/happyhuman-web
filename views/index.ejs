<%- include('layout/header') %>

<div class="container mt-4">
    <div id="welcomeMessage" class="welcome-text lead fw-bold text-primary mb-4 p-3 bg-light rounded text-center">
        Assalamualaikum! Happy People.
    </div>

    <div class="row">
        <% if (posts.length > 0) { %>
            <% posts.forEach(post => { %>
                <div class="col-md-6 mb-4">
                    <div class="card h-100 shadow-sm border-0">
                        <% if(post.image) { %>
                            <img src="/<%= post.image %>" class="card-img-top" style="height: 250px; object-fit: cover;" alt="Post Image">
                        <% } %>

                        <div class="card-body d-flex flex-column">
                            <div>
                                <span class="badge bg-success mb-2"><%= post.category %></span>
                            </div>
                            
                            <h4 class="card-title fw-bold"><%= post.title %></h4>
                            <p class="card-text text-muted">
                                <%= post.body.length > 150 ? post.body.substring(0, 150) + "..." : post.body %>
                            </p>
                            
                            <div class="mt-auto">
                                <hr>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-secondary">By: <b><%= post.author %></b></small>
                                    
                                    <% if (typeof user !== 'undefined' && user) { %> 
                                        <% if (user.email === post.authorEmail || user.role === 'admin') { %>
                                            <div class="btn-group">
                                                <a href="/edit/<%= post._id %>" class="btn btn-sm btn-primary text-white">
                                                    <i class="fas fa-edit"></i> Edit
                                                </a>
                                                <a href="/delete/<%= post._id %>" class="btn btn-sm btn-danger" 
                                                   onclick="return confirm('Are you sure you want to delete this post?')">
                                                    <i class="fas fa-trash"></i> Delete
                                                </a>
                                            </div>
                                        <% } %>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <% }) %>
        <% } else { %>
            <div class="col-12 text-center py-5">
                <h3 class="text-muted">No stories shared yet.</h3>
                <p>Be the one to start the chain of happiness!</p>
                <a href="/add" class="btn btn-success px-4">Share Happiness</a>
            </div>
        <% } %>
    </div>
</div>

<script>
    window.onload = function() {
        const hour = new Date().getHours();
        const msg = document.getElementById('welcomeMessage');
        if (hour < 12) msg.textContent = "Good Morning! Have a Happy Day.";
        else if (hour < 18) msg.textContent = "Good Afternoon! Enjoy Your Time.";
        else msg.textContent = "Good Evening! Stay Happy.";
    };
</script>

<%- include('layout/footer') %>